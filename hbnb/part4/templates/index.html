<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>HBNB - Accueil</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="../static/styles.css" />
</head>
<body>
    <header>
    <a id="login-link" href="http://localhost:5000/login">Se connecter</a>
  </header>
  <main>
    <h1>Bienvenue sur HBNB !</h1>
    <!-- autres meta et styles ici -->
      <div>
    <label for="price-filter">Filtrer par prix :</label>
    <select id="price-filter">
      <option value="All" selected>Tous les prix</option>
      <option value="10">10 €</option>
      <option value="50">50 €</option>
      <option value="100">100 €</option>
      <option value="150">Jusqu'à 150€</option>
    </select>
    <section id="login-section">
    <h2>Connexion</h2>
    <form id="login-form">
      <input type="email" name="email" placeholder="Email" required />
      <input type="password" name="password" placeholder="Mot de passe" required />
      <button type="submit">Se connecter</button>
      <span id="login-error" style="color: red;"></span>
    </form>
    </section>
    <h2>Nos logements disponibles</h2>
    <div id="places-container"></div>
  </div>
    <section id="places-list">
      <!-- Les logements viendront s’afficher ici dynamiquement -->
    </section>
    <!-- Bouton déconnexion caché par défaut -->
    <button id="logout-btn" style="display:none;">Déconnexion</button>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      const logoutBtn = document.getElementById('logout-btn');
      const placesList = document.getElementById('places-list');

      try {
        // Vérification connexion via endpoint /auth/status
        const response = await fetch('http://localhost:5000/api/v1/auth/status', {
          method: 'GET',
          credentials: 'include'  // Envoie les cookies (notamment JWT HttpOnly)
        });

        if (response.ok) {
          // Si connecté, affiche bouton déconnexion
          logoutBtn.style.display = 'inline-block'; 
        } else {
          // Pas connecté, redirection vers login
          window.location.href = 'login.html';
          return;
        }
      } catch (err) {
        console.error('Erreur lors de la vérification de connexion :', err);
        window.location.href = 'login.html';
        return;
      }

      // Événement déconnexion
      logoutBtn.addEventListener('click', async () => {
        try {
          const res = await fetch('http://localhost:5000/api/v1/auth/logout', {
            method: 'POST',
            credentials: 'include',  // Important pour envoyer cookie et pouvoir supprimer côté serveur
            headers: { 'Content-Type': 'application/json' }
          });
          if (res.ok) {
            // Redirection vers login après déconnexion réussie
            window.location.href = 'login.html';
          } else {
            alert('Erreur lors de la déconnexion');
          }
        } catch (error) {
          alert('Erreur réseau lors de la déconnexion');
          console.error(error);
        }
      });
    });
  </script>

  <script src="../static/scripts.js"></script>
</body>
</html>
