<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>HBNB - Accueil</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="../static/styles.css" />
</head>
<body>
  <main>
    <h1>Bienvenue sur HBNB !</h1>
    <section id="places-list">
      <!-- Liste des logements (à récupérer avec API + token) -->
    </section>

    <!-- Bouton déconnexion caché par défaut -->
    <button id="logout-btn" style="display:none;">Déconnexion</button>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      const logoutBtn = document.getElementById('logout-btn');
      const placesList = document.getElementById('places-list');

      try {
        // Vérification connexion via endpoint /auth/status
        const response = await fetch('http://localhost:5000/api/v1/auth/status', {
          method: 'GET',
          credentials: 'include'  // Envoie les cookies (notamment JWT HttpOnly)
        });

        if (response.ok) {
          // Si connecté, affiche bouton déconnexion
          logoutBtn.style.display = 'inline-block';

          // Éventuel chargement / affichage de la liste des logements ici
          placesList.innerHTML = `<p>Voici la liste des logements disponibles (à implémenter).</p>`;
        } else {
          // Pas connecté, redirection vers login
          window.location.href = 'login.html';
          return;
        }
      } catch (err) {
        console.error('Erreur lors de la vérification de connexion :', err);
        window.location.href = 'login.html';
        return;
      }

      // Événement déconnexion
      logoutBtn.addEventListener('click', async () => {
        try {
          const res = await fetch('http://localhost:5000/api/v1/auth/logout', {
            method: 'POST',
            credentials: 'include',  // Important pour envoyer cookie et pouvoir supprimer côté serveur
            headers: { 'Content-Type': 'application/json' }
          });
          if (res.ok) {
            // Redirection vers login après déconnexion réussie
            window.location.href = 'login.html';
          } else {
            alert('Erreur lors de la déconnexion');
          }
        } catch (error) {
          alert('Erreur réseau lors de la déconnexion');
          console.error(error);
        }
      });
    });
  </script>

  <script src="../static/scripts.js"></script>
</body>
</html>

