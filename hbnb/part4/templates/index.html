<!DOCTYPE html>
<html lang="fr">

  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Holberton HBNB - Accueil</title>
    <!-- Ajoute ici tes liens CSS, favicon, etc. -->
    <link rel="stylesheet" href="/static/styles.css" />

  </head>

<header>
    <a id="loginBtn" href="#" class="login-button" style="display:block; float:right;">Connexion</a>
  <a id="logoutBtn" href="#" class="logout-button" style="display:none; float:right;">Déconnexion</a>
  <h1>
    Bienvenue sur HBNB
  </h1>
  <!-- Ici tu peux avoir ta barre de navigation -->
</header>

<main>
  <!-- Section modale cachée avec le formulaire à l'intérieur -->
  <section id="login-section"
      style="
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.4);
      justify-content: center;
      align-items: center;
      z-index: 1000;">
    <form id="login-form"
        style="background: #fff;
        padding: 2em 2em 1.5em;
        border-radius: 8px;
        position: relative;
        min-width: 300px;
        box-shadow: 0 0 15px rgba(0,0,0,0.3);
        display: flex;
        flex-direction: column;
        gap: 1em;">
      <!-- Bouton fermer -->
      <button type="button" id="close-login-form"
          style="position: absolute;
          top: 10px; right: 10px; border: none;
          background: transparent;
          font-size: 1.5rem;
          cursor: pointer;
          color: #333;">&times;</button>
      <h2>Connexion</h2>
      <input type="email" id="email" name="email" placeholder="Email" required />
      <input type="password" id="password" name="password" placeholder="Mot de passe" required />
      <button type="submit">Se connecter</button>
      <p id="login-error" style="color: red; font-weight: bold; margin: 0;"></p>
    </form>
  </section>
  <!-- ... le reste de ton contenu ... -->
</main>

  <!-- === Section Liste des logements === -->
  <section id="places-list-section">
    <h2>Logements disponibles</h2>
      <div id="places-list"></div>
    <!-- Les logements viendront s’afficher ici dynamiquement -->

    <!-- Filtre prix -->
    <div class="filter-container" style="margin: 1em 0;">
      <label for="price-filter">Filtrer par prix : </label>
      <select id="price-filter" name="price-filter">
        <option value="all" selected>Tous les prix</option>
        <option value="50">Jusqu'à 50€</option>
        <option value="100">Jusqu'à 100€</option>
        <option value="150">Jusqu'à 150€</option>
        <!-- Tu peux ajouter d’autres options ici -->
      </select>
    </div>

    <!-- Conteneur vide où ton JS affichera les places -->
    <div id="places-container"></div>
  </section>

  </main>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      const logoutBtn = document.getElementById('logout-btn');
      const placesList = document.getElementById('places-list');
      const loginLink = document.getElementById('login-link');

      try {
        // Vérification connexion via endpoint /auth/status
        const response = await fetch('http://localhost:5000/api/v1/auth/status', {
          method: 'GET',
          credentials: 'include'  // Envoie les cookies (notamment JWT HttpOnly)
        });

    if (response.ok) {
      // Utilisateur connecté
      logoutBtn.style.display = 'inline-block';   // afficher déconnexion
      loginLink.style.display = 'none';           // masquer lien login
    } else {
      // Utilisateur NON connecté
      logoutBtn.style.display = 'none';           // masquer déconnexion
      loginLink.style.display = 'inline';         // afficher lien login
      // PAS de redirection automatique ici !
    }
  } catch (err) {
    console.error('Erreur lors de la vérification de connexion :', err);
    // S'il y a une erreur, considérer comme non connecté (visiteur)
    logoutBtn.style.display = 'none';
    loginLink.style.display = 'inline';
  }

      // Événement déconnexion
      logoutBtn.addEventListener('click', async () => {
        try {
          const res = await fetch('http://localhost:5000/api/v1/auth/logout', {
            method: 'POST',
            credentials: 'include',  // Important pour envoyer cookie et pouvoir supprimer côté serveur
            headers: { 'Content-Type': 'application/json' }
          });
          if (res.ok) {
            // Redirection vers login après déconnexion réussie
            window.location.href = 'login.html';
          } else {
            alert('Erreur lors de la déconnexion');
          }
        } catch (error) {
          alert('Erreur réseau lors de la déconnexion');
          console.error(error);
        }
      });
    });
  </script>

<footer style="margin-top: 3em; text-align: center;">
  <p>© Holberton HBNB - 2025</p>
</footer>

  <script src="/static/scripts.js" defer></script>
</body>
</html>
